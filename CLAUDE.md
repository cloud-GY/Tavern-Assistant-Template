# 酒馆助手前端界面或脚本编写

@.cursor/rules/项目基本概念.mdc
@.cursor/rules/mcp.mdc
@.cursor/rules/酒馆变量.mdc
<<<<<<< HEAD
=======
@.cursor/rules/酒馆助手接口.mdc
>>>>>>> 2837cbac784d0808fabe79c350edf0757ddf7e98
@.cursor/rules/前端界面.mdc
@.cursor/rules/脚本.mdc
@.cursor/rules/mvu变量框架.mdc
@.cursor/rules/mvu角色卡.mdc
<<<<<<< HEAD

### MVU 变量进阶知识补充

#### 1. 变量初始化的特殊数据结构
MVU 的变量初始化（`initvar`）并非简单的键值对，而是采用一种**带描述的数组格式**。这种设计旨在让 AI 在读取变量的同时，能够理解该变量的含义和格式规范。注意，MVU变量初始化必须采用json而不是yaml。

*   **格式规范**：`"变量名": [具体内容, 补充说明]`
*   **示例**：
   ```json
    {
      "日期": ["03月15日", "今天的日期，格式为 mm月dd日"],
      "好感度": [50, "角色对玩家的好感程度，范围 0-100"]
    }
    ```
*   **逻辑意义**：
    *   **值 1 (Index 0)**：实际存储的数据内容，供脚本逻辑和宏引用使用。
    *   **值 2 (Index 1)**：元数据/注释，仅在提示词阶段提供给 AI，帮助其理解变量背景，不参与逻辑运算。

#### 2. MVU 核心工作流程（面向用户与 AI）
整个框架通过“初始化 -> 提示引导 -> 逻辑修改 -> 实时回显”形成闭环：

1.  **初始化 (User Side)**：用户在世界书中通过 `initvar` 条目，按照上述数组格式设置变量的初始状态。
2.  **规则注入 (Prompt Side)**：
    *   系统会自动生成包含**当前全部变量内容**的提示词。
    *   提示词中会包含操作指南，引导 AI 使用 `_.set('${path}', ${old}, ${new});//${reason}` 等 lodash 命令来生成变量修改指令。示例 `_.set('悠纪.好感度', 33,35);`
3.  **变量修改 (AI Side)**：AI 在输出中包含特定的 MVU 命令，MVU 框架解析这些命令并更新对应楼层的 `stat_data`。
4.  **前端回显 (Display Side)**：
    *   **宏引用**：在聊天界面、角色描述或世界书中，使用酒馆宏动态读取变量。
    *   **索引指向**：由于初始化采用了数组格式，引用具体内容时必须指向索引 `0`。
    *   **示例**：
        *   输入：`日期：{{get_message_variable::stat_data.日期.0}}`
        *   输出：`日期：03月15日`
    *   **前端代码**：配合 Vue 等前端组件，可以实时监听 `stat_data` 的变化并进行图形化渲染（如进度条、状态栏）。

###开发建议：在编写前端界面或脚本逻辑时，应通过 Mvu.getMvuData 或 store.ts 提供的响应式对象获取变量，严禁在代码逻辑中使用酒馆宏字符串，以确保数据的实时性和类型安全。
=======
>>>>>>> 2837cbac784d0808fabe79c350edf0757ddf7e98

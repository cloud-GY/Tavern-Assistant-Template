{"version":3,"file":"index.js","mappings":"AAIA,SAASA,EAAgBC,GACvB,MAAMC,EAAiBC,EAAE,eAAeF,OACxC,GAA8B,IAA1BC,EAAeE,OAAc,OAEjC,MAAMC,EAAeH,EAAeI,KAAK,wBACzC,GAA4B,IAAxBD,EAAaD,OAAc,OAE/B,MAAMG,EAAaF,EAAaG,OAAOC,MAAM,UAC7C,IAAKF,EAAY,OAEjB,MAAMG,EAAUR,EAAeI,KAAK,aAAaK,QACjDD,EAAQJ,KAAK,WAAWM,SACxB,IAAIC,EAAUH,EAAQF,OAGpBK,EAAUA,EAAQC,QAAQ,wBAAyB,IAGrD,MAAMC,EAAeF,EAAQT,OAC7B,IAAIY,EAAiB,EAEA,CACnB,IAAIC,EAAYf,EAAeI,KAAK,kBAAkBE,OAEpDS,EAAYA,EAAUH,QAAQ,wBAAyB,IAEzDE,EAAiBC,EAAUb,MAC7B,CAEA,MAAMc,EAAaX,EAAW,GACxBY,EAA6BH,EAAiB,EAChD,GAAGE,MAAeF,KAAkBD,KACpC,GAAGG,MAAeH,KAEtBV,EAAaG,KAAKW,EACpB,CAEAhB,EAAE,KACAiB,QAAQC,cAAcC,iBAAmBrB,IACvCsB,WAAW,IAAMvB,EAAgBwB,OAAOvB,IAAa,OAGvDmB,QAAQC,cAAcI,gBAAkBxB,IACtCsB,WAAW,IAAMvB,EAAgBwB,OAAOvB,IAAa,OAGvDmB,QAAQC,cAAcK,sBAAuB,CAACC,EAAGC,EAAI3B,KACnDsB,WAAW,IAAMvB,EAAgBC,GAAY","sources":["src://tavern_helper_template/src/字数统计/index.ts"],"sourcesContent":["// 配置开关\nconst IGNORE_TAGS = true; // 是否忽略 <标签>内容</标签> 格式\nconst COUNT_REASONING = true; // 是否统计思考内容\n\nfunction updateWordCount(messageId: number) {\n  const messageElement = $(`.mes[mesid=\"${messageId}\"]`);\n  if (messageElement.length === 0) return;\n  \n  const tokenElement = messageElement.find('.tokenCounterDisplay');\n  if (tokenElement.length === 0) return;\n  \n  const tokenMatch = tokenElement.text().match(/(\\d+)t/);\n  if (!tokenMatch) return;\n  \n  const mesText = messageElement.find('.mes_text').clone();\n  mesText.find('details').remove();\n  let content = mesText.text();\n  \n  if (IGNORE_TAGS) {\n    content = content.replace(/<[^>]+>.*?<\\/[^>]+>/gs, '');\n  }\n  \n  const contentCount = content.length;\n  let reasoningCount = 0;\n  \n  if (COUNT_REASONING) {\n    let reasoning = messageElement.find('.mes_reasoning').text();\n    if (IGNORE_TAGS) {\n      reasoning = reasoning.replace(/<[^>]+>.*?<\\/[^>]+>/gs, '');\n    }\n    reasoningCount = reasoning.length;\n  }\n  \n  const tokenCount = tokenMatch[1];\n  const newText = COUNT_REASONING && reasoningCount > 0\n    ? `${tokenCount}t(${reasoningCount}+${contentCount})`\n    : `${tokenCount}t(${contentCount})`;\n  \n  tokenElement.text(newText);\n}\n\n$(() => {\n  eventOn(tavern_events.MESSAGE_RECEIVED, (messageId) => {\n    setTimeout(() => updateWordCount(Number(messageId)), 200);\n  });\n  \n  eventOn(tavern_events.MESSAGE_UPDATED, (messageId) => {\n    setTimeout(() => updateWordCount(Number(messageId)), 200);\n  });\n  \n  eventOn(tavern_events.STREAM_REASONING_DONE, (_, __, messageId) => {\n    setTimeout(() => updateWordCount(messageId), 200);\n  });\n});\n"],"names":["updateWordCount","messageId","messageElement","$","length","tokenElement","find","tokenMatch","text","match","mesText","clone","remove","content","replace","contentCount","reasoningCount","reasoning","tokenCount","newText","eventOn","tavern_events","MESSAGE_RECEIVED","setTimeout","Number","MESSAGE_UPDATED","STREAM_REASONING_DONE","_","__"],"ignoreList":[],"sourceRoot":""}